controller_manager:
  ros__parameters:
    update_rate: 100  # Hz
    
    # Controller definitions
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster
    
    wc_control:
      type: diff_drive_controller/DiffDriveController
    
    imu_sensor_broadcaster:
      type: imu_sensor_broadcaster/IMUSensorBroadcaster
    
    simple_velocity_controller:
      type: velocity_controllers/JointGroupVelocityController

# Differential Drive Controller Configuration
wc_control:
  ros__parameters:
    # Joint names - FIXED to use leftwheel/rightwheel
    left_wheel_names: ['leftwheel']
    right_wheel_names: ['rightwheel']

    # Use stamped velocity commands (TwistStamped)
    use_stamped_vel: true

    # Publish rates and covariances
    publish_rate: 50.0
    pose_covariance_diagonal: [0.001, 0.001, 1.0e-3, 1.0e-3, 1.0e-3, 0.01]
    twist_covariance_diagonal: [0.001, 0.001, 1.0e-3, 1.0e-3, 1.0e-3, 0.01]
    
    # Wheel parameters - ACTUAL physical measurements!
    wheel_separation: 0.565  # ACTUAL measured wheelbase
    wheel_radius: 0.1524     # ACTUAL 6-inch wheels
    wheel_separation_multiplier: 1.0
    left_wheel_radius_multiplier: 1.0
    right_wheel_radius_multiplier: 1.0
    
    # Command timeout
    cmd_vel_timeout: 0.5
    
    # Frame IDs (must match URDF)
    base_frame_id: base_link  # Matches wheelchair URDF
    odom_frame_id: odom
    
    # Publishing options
    publish_limited_velocity: true
    publish_wheel_data: true
    enable_odom_tf: false  # DISABLED - EKF publishes odom->base_link (prevents TF conflict!)

    # Velocity and acceleration limits
    linear:
      x:
        has_velocity_limits: true
        max_velocity: 2.0  # m/s
        min_velocity: -1.0 # m/s
        has_acceleration_limits: true
        max_acceleration: 1.5  # m/s^2
        min_acceleration: -1.0 # m/s^2
        has_jerk_limits: false
        max_jerk: 5.0  # m/s^3
    
    angular:
      z:
        has_velocity_limits: true
        max_velocity: 3.0  # rad/s
        has_acceleration_limits: true
        max_acceleration: 2.0  # rad/s^2
        has_jerk_limits: false
        max_jerk: 3.0  # rad/s^3

# Simple Velocity Controller Configuration (alternative/backup)
simple_velocity_controller:
  ros__parameters:
    joints:
      - leftwheel
      - rightwheel
    interface_name: velocity
    command_interfaces:
      - velocity
    state_interfaces:
      - position
      - velocity

# Joint State Broadcaster Configuration
joint_state_broadcaster:
  ros__parameters:
    joints:
      - leftwheel
      - rightwheel

# IMU Sensor Broadcaster Configuration
imu_sensor_broadcaster:
  ros__parameters:
    sensor_name: imu
    frame_id: base_link  # Frame where IMU is mounted
    topic_name: ~/imu  # Will publish to /imu_sensor_broadcaster/imu
