# =============================================================================
# WHEELCHAIR COSTMAP FUSION - D455 DEPTH + RPLIDAR S3
# =============================================================================
# Robust obstacle avoidance using dual sensor fusion
# =============================================================================

# =============================================================================
# LOCAL COSTMAP - Rolling window for reactive obstacle avoidance
# =============================================================================
local_costmap:
  ros__parameters:
    update_frequency: 5.0
    publish_frequency: 2.0
    global_frame: odom
    robot_base_frame: base_link
    use_sim_time: false
    rolling_window: true
    width: 5
    height: 5
    resolution: 0.05
    robot_radius: 0.40
    footprint_padding: 0.03
    transform_tolerance: 1.0

    plugins: ["obstacle_layer", "voxel_layer", "inflation_layer"]

    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      enabled: true
      observation_sources: scan
      scan:
        topic: /scan
        max_obstacle_height: 2.0
        min_obstacle_height: 0.0
        clearing: true
        marking: true
        data_type: "LaserScan"
        raytrace_max_range: 8.0
        raytrace_min_range: 0.0
        obstacle_max_range: 6.0
        obstacle_min_range: 0.15
        inf_is_valid: false

    voxel_layer:
      plugin: "nav2_costmap_2d::VoxelLayer"
      enabled: true
      publish_voxel_map: true
      origin_z: 0.0
      z_resolution: 0.05
      z_voxels: 16
      max_obstacle_height: 2.0
      mark_threshold: 0
      observation_sources: depth_camera
      depth_camera:
        topic: /camera/depth/color/points
        max_obstacle_height: 2.0
        min_obstacle_height: 0.1
        obstacle_max_range: 3.5
        obstacle_min_range: 0.3
        raytrace_max_range: 4.0
        raytrace_min_range: 0.3
        clearing: true
        marking: true
        data_type: "PointCloud2"
        inf_is_valid: false

    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      cost_scaling_factor: 3.0
      inflation_radius: 0.55

    always_send_full_costmap: true

# =============================================================================
# GLOBAL COSTMAP - Static map + dynamic obstacles
# =============================================================================
global_costmap:
  ros__parameters:
    update_frequency: 1.0
    publish_frequency: 1.0
    global_frame: map
    robot_base_frame: base_link
    use_sim_time: false
    robot_radius: 0.40
    resolution: 0.05
    track_unknown_space: true
    transform_tolerance: 1.0

    plugins: ["static_layer", "obstacle_layer", "inflation_layer"]

    static_layer:
      plugin: "nav2_costmap_2d::StaticLayer"
      map_subscribe_transient_local: true

    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      enabled: true
      observation_sources: scan
      scan:
        topic: /scan
        max_obstacle_height: 2.0
        clearing: true
        marking: true
        data_type: "LaserScan"
        raytrace_max_range: 8.0
        raytrace_min_range: 0.0
        obstacle_max_range: 6.0
        obstacle_min_range: 0.15

    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      cost_scaling_factor: 3.0
      inflation_radius: 0.55

    always_send_full_costmap: true
